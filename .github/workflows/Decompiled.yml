name: Decompile all RPYC to RPY üíÄ‚ò†Ô∏èüòà

on:
  push:
    paths:
      - 'to_rpy/**/*.rpyc'
      - '.github/workflows/decompile_rpyc.yml'

jobs:
  decompile:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install unrpyc
        run: pip install unrpyc
      
      - name: Create output folder (to_rpy_decompiled)
        run: mkdir -p to_rpy_decompiled

      - name: Decompile all .rpyc files in to_rpy
        run: |
          set -x  # aktifkan debug output
          
          if [ ! -d "to_rpy" ]; then
            echo "Folder to_rpy tidak ditemukan!"
            exit 1
          fi

          find to_rpy -type f -name "*.rpyc" | while read -r file; do
            echo "Mengolah file: $file"
            output_file="to_rpy_decompiled/$(basename "$file" .rpyc).rpy"
            
            unrpyc "$file" --output "$output_file"
            if [ $? -ne 0 ]; then
              echo "ERROR: Gagal dekompilasi $file"
              exit 1
            fi
          done

      - name: List hasil dekompilasi
        run: |
          echo "File hasil decompile di to_rpy_decompiled:"
          ls -l to_rpy_decompiled/
